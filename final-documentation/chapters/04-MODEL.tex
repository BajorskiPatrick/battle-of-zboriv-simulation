\chapter{MODEL FORMALNY} \label{ch:procedure}

\section{Szczegółowy model zachowania agenta}

Logika decyzyjna każdego agenta (\textit{MilitaryAgent}) jest wykonywana w każdej turze symulacji. Proces ten jest deterministyczno-stochastyczny: reguły są stałe, ale ich wynik zależy od rzutów prawdopodobieństwa (np. test morale, szansa na trafienie).

W modelu zaimplementowano zaawansowane mechanizmy psychologii tłumu, symulujące efekt domina na polu bitwy:
\begin{itemize}
    \item \textbf{Panika Łańcuchowa (Chain Panic):} Gdy jednostka nie zda testu morale i rzuci się do ucieczki, wywołuje to falę strachu u pobliskich sojuszników (w promieniu 3 pól), obniżając ich morale. Siła tego efektu jest tym mniejsza, im większa jest dyscyplina obserwatorów (dla zdyscyplinowanych żołnierzy efekt ten jest zerowy).
    \item \textbf{Panika po Śmierci (Death Panic):} Eliminacja jednostki wywołuje silny wstrząs psychiczny u towarzyszy znajdujących się w bezpośrednim sąsiedztwie, co może prowadzić do załamania całej formacji, nawet jeśli nie była ona bezpośrednio atakowana. Siła tego efektu zależy od dyscypliny analogicznie, jak w przypadku Paniki Łańcuchowej.
\end{itemize}

Poniżej przedstawiono kompletny algorytm cyklu życia agenta (Algorytm \ref{alg:main_loop}), procedurę obsługi obrażeń (Algorytm \ref{alg:receive_damage}) oraz dedykowaną procedurę obsługi ucieczki (Algorytm \ref{alg:fleeing}).

\input{algorithms/alg}

\AlgMainLoop

\AlgReceiveDamage

\section{Algorytm ucieczki i regeneracji}

Unikalnym elementem modelu jest zróżnicowana strategia ucieczki. Jednostki Kozackie zawsze uciekają do krawędzi mapy. Jednostki Koronne podejmują decyzję: jeśli Obóz (Centrum Leczenia) jest bliżej niż krawędź mapy i posiada wolne miejsca, agent spróbuje się tam schronić, aby zregenerować siły (HP i Morale).

\AlgManageFleeing