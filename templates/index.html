<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulacja Bitwy pod Zborowem (1649)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Symulacja Bitwy pod Zborowem (1649)</h1>
            <p class="subtitle">Interaktywna symulacja agentowa historycznej bitwy</p>
        </header>
        
        <!-- Przyciski nawigacyjne -->
        <div class="navigation-buttons">
            <button class="nav-btn active" id="navScenarios" onclick="showPage('scenarios')">
                Scenariusze
            </button>
            <button class="nav-btn" id="navLegend" onclick="showPage('legend')">
                Legenda Jednostek
            </button>
            <a class="nav-btn" href="{{ url_for('dashboard') }}" target="_blank" rel="noopener">
                üìä Dashboard
            </a>
        </div>
        
        <div class="main-grid">
            <!-- Strona scenariuszy -->
            <div class="page-container scenarios-page active" id="scenariosPage">
                <div class="panel scenarios-panel">
                    <h2>Wybierz Scenariusz Bitwy</h2>
                    <p style="color: #b0b0b0; font-size: 0.9em; margin-bottom: 20px; line-height: 1.5;">
                        Kliknij na scenariusz, aby rozpoczƒÖƒá symulacjƒô. Ka≈ºdy scenariusz przedstawia r√≥≈ºne proporcje si≈Ç i taktyki.
                    </p>
                    
                    <!-- Button to open Custom Battle -->
                    <button class="btn btn-start" onclick="showCustomBattle()" style="margin-bottom: 25px; background: linear-gradient(45deg, #4a148c, #7b1fa2); width: 100%; padding: 15px; font-size: 1.1em;">
                        üõ†Ô∏è Stw√≥rz W≈ÇasnƒÖ Bitwƒô (Custom)
                    </button>
                    
                    <div class="weather-selector-container" style="margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 4px; border: 1px solid #444;">
                        <label style="color: #ccc; font-weight: 500; margin-right: 10px;">Warunki pogodowe:</label>
                        <select id="scenarioWeatherSelect" style="background: #222; color: #fff; border: 1px solid #555; padding: 6px 12px; border-radius: 4px; font-size: 1em;">
                            <option value="clear">‚òÄÔ∏è Normalne (S≈Çonecznie)</option>
                            <option value="rain">üåßÔ∏è Deszcz (B≈Çoto, mokry proch)</option>
                            <option value="fog">üå´Ô∏è Mg≈Ça (Ograniczona widoczno≈õƒá)</option>
                        </select>
                    </div>

                    <div class="scenarios-grid" id="scenariosGrid"></div>
                    <div class="loader" id="loader"></div>
                </div>
            </div>

            <!-- Strona W≈Çasnej Bitwy (Custom Battle) -->
            <div class="page-container custom-page" id="customBattlePage">
                <div class="custom-layout">
                    <!-- Lewy Panel: Korona -->
                    <div class="panel side-panel crown-border">
                        <h2 class="crown-color" style="margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px;">Armia Koronna</h2>
                        <div class="unit-controls" id="crownControls">
                            <!-- Generowane przez JS -->
                        </div>
                    </div>

                    <!-- ≈örodkowy Panel: Info i Start -->
                    <div class="panel center-panel">
                        <div class="weather-control" style="margin-bottom: 20px; width: 80%;">
                            <label style="color: #aaa; display: block; margin-bottom: 8px;">Warunki pogodowe:</label>
                            <select id="customWeatherSelect" class="filter-select" style="width: 100%; background: #333; color: white; border: 1px solid #555; padding: 10px; border-radius: 4px;">
                                <option value="clear">‚òÄÔ∏è Normalne (S≈Çonecznie)</option>
                                <option value="rain">üåßÔ∏è Deszcz (B≈Çoto, mokry proch)</option>
                                <option value="fog">üå´Ô∏è Mg≈Ça (Ograniczona widoczno≈õƒá)</option>
                            </select>
                        </div>

                        <h2 style="margin-bottom: 10px;">Konfiguracja Bitwy</h2>
                        <p style="color: #aaa;">Ustaw liczebno≈õƒá wojsk po obu stronach.</p>
                        
                        <div class="vs-badge">VS</div>
                        
                        <div class="total-summary">
                            <div id="crownTotalDisplay" class="crown-color">0</div>
                            <div style="color: #555;">:</div>
                            <div id="cossackTotalDisplay" class="cossack-color">0</div>
                        </div>
                        
                        <button class="btn btn-start" onclick="startCustomSimulation()" style="width: 80%; padding: 15px; font-size: 1.2em; margin-bottom: 15px;">
                            ROZPOCZNIJ BITWƒò
                        </button>
                        <button class="btn" onclick="backToScenarios()" style="width: 80%; background: #333; border: 1px solid #444;">
                            ANULUJ
                        </button>
                    </div>

                    <!-- Prawy Panel: Kozacy -->
                    <div class="panel side-panel cossack-border">
                        <h2 class="cossack-color" style="margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px;">Kozacy i Tatarzy</h2>
                        <div class="unit-controls" id="cossackControls">
                            <!-- Generowane przez JS -->
                        </div>
                    </div>
                </div>
                <div class="custom-error-toast" id="customErrorToast" aria-live="assertive"></div>
            </div>
                
            <!-- Strona legendy -->
            <div class="page-container legend-page" id="legendPage">
                <div class="panel">
                    <h2>Legenda Jednostek</h2>
                    <div class="legend-factions">
                        <!-- Armia Koronna -->
                        <div class="legend-faction-section crown">
                            <div class="legend-faction-title crown">Armia Koronna</div>
                            <div id="crownLegendContainer"></div>
                    </div>
                        
                        <!-- Kozacy i Tatarzy -->
                        <div class="legend-faction-section cossack">
                            <div class="legend-faction-title cossack">Kozacy i Tatarzy</div>
                            <div id="cossackLegendContainer"></div>
                        </div>
                    </div>
                </div>
                </div>
                
            <!-- Panel kontroli (ukryty na poczƒÖtku) -->
            <div class="panel control-panel" id="controlPanel" style="display: none;">
                <h2>Kontrola Symulacji</h2>
                <div class="controls">
                    <button class="btn btn-stop" id="pauseBtn" onclick="togglePause()">
                        ‚è∏Ô∏è Pauza
                    </button>
                    <button class="btn btn-stop" id="stopBtn" onclick="stopSimulation()" style="margin-top: 10px; width: 100%;">
                        ‚èπÔ∏è Zatrzymaj i Powr√≥t
                    </button>
                </div>

                <!-- Kontrola pogody w czasie rzeczywistym
                <div class="controls-weather" style="margin-top: 15px; border-top: 1px solid #444; padding-top: 10px;">
                    <h3 style="font-size: 0.9em; color: #aaa; margin-bottom: 8px;">Efekty Pogodowe</h3>
                    <div style="display: flex; gap: 5px; justify-content: space-between;">
                        <button class="btn" onclick="setWeather('clear')" style="flex: 1; padding: 5px;" title="S≈Çonecznie">‚òÄÔ∏è</button>
                        <button class="btn" onclick="setWeather('rain')" style="flex: 1; padding: 5px;" title="Deszcz">üåßÔ∏è</button>
                        <button class="btn" onclick="setWeather('fog')" style="flex: 1; padding: 5px;" title="Mg≈Ça">üå´Ô∏è</button>
                    </div>
                </div> -->

                <!-- Statystyki bitwy przeniesione pod panel kontroli -->
                <div class="battle-stats" id="battleStats" style="display: none;">
                    <h3 style="margin-top: 16px; margin-bottom: 12px; font-size: 1.1em; font-weight: 500; color: #ffffff; padding-bottom: 10px; border-bottom: 1px solid #3a3a3a;">Statystyki Bitwy</h3>
                    <div class="stat-row">
                        <span class="stat-label-main crown-color">Armia Koronna:</span>
                        <span class="stat-value-main crown-color" id="crownCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label-main cossack-color">Kozacy/Tatarzy:</span>
                        <span class="stat-value-main cossack-color" id="cossackCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label-main">≈ÅƒÖcznie jednostek:</span>
                        <span class="stat-value-main" id="totalCount">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Obszar symulacji -->
            <div class="panel simulation-area" id="simulationArea" style="display: none;">
                <div class="simulation-status status-idle" id="status">
                    Gotowa do startu
                </div>
                <canvas id="simulationCanvas"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Modal zwyciƒôstwa -->
    <div id="victoryModal" class="victory-modal">
        <div class="victory-content">
            <div class="victory-title">KONIEC BITWY</div>
            <div id="victoryWinner" class="victory-winner"></div>
            <div id="victoryStats" class="victory-stats"></div>
            <button class="victory-button" onclick="restartSimulation()">Nowa Bitwa</button>
            <button class="victory-button" onclick="closeVictoryModal()">Zobacz Pole Bitwy</button>
        </div>
    </div>
</body>
</html>
